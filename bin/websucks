#! /usr/bin/env python
# TODO: handle the extra parameters using optparser or
# argparser

import sys

from ws4py.server.geventserver import WebSocketServer

from websucks.amq import AMQServer


def ws_amq_handler(websocket, env):
    try:
        print "New connection made."
        server = AMQServer('localhost', websocket)
        server.run()

    finally:
        websocket.close()



if __name__ == "__main__":
    
    host = '127.0.0.1'
    port = 9000

    if len(sys.argv) > 1:
        host = sys.argv[1]

    if len(sys.argv) > 2:
        port = int(sys.argv[2])

    server = AMQServer('localhost')
    print "Websocket server started at %s:%s" % (host, port)
    server = WebSocketServer((host, port), server.run)
    try:
        server.serve_forever()
    except KeyboardInterrupt:
        server.stop()
